def calc_SMA(data:list[dict], params: dict = {'n': 14}):
    n = params['n']
    #datalist = list(enumerate(data))
    smalist = []#с базы идет список словарей, надо ьоже делать список время-значение sma итак же в остальных функ,
    i = 0
    for candle in data:
        if i > n - 1:
            lastncandles = data[i - n:i]
            closesum = 0
            for cndl in lastncandles:
                closesum += float(cndl[1]['ohlc'][3])
            sma = closesum / n

        else:
            sma = float(cndl[1]['ohlc'][3])
        smaitem = {'open_time': candle['open_time'],
                   'SMA': sma}
        smalist.append(smaitem)
        i += 1
    return smalist


def calc_EMA(data, params: dict = {'n': 14}):
    n = params['n']

    def ema(price, emaTminus):
        alpha = 2 / (n + 1)
        emaT = alpha * price + (1 - alpha) * emaTminus
        return emaT
    i = 0
    emalist = []
    for candle in data:
        if i > 0:
            closeCurrent = float(candle['ohlc'][3])
            emacurrent = ema(closeCurrent, ematiminus)

        else:
            emacurrent = float(candle['ohlc'][3])
        ematiminus = emacurrent
        emaitem = {'open_time': candle['open_time'],
                   'EMA': emacurrent}
        emalist.append(emaitem)
        i += 1

    return emalist


def calc_RSI(data: object, params: dict = {'n': 14}) -> object:
    n = params['n']

    def getUDvalues():  # putts U and D values of days in relevant columns
        UDlist = []
        i = 0
        for candle in data:
            if i > 0:
                diff = float(candle['ohlc'][3]) - float(data[i - 1]['ohlc'][3])
                if diff > 0:
                    u = diff
                    d = 0
                elif diff < 0:
                    u = 0
                    d = -diff
                elif diff == 0:
                    u = 0
                    d = 0
            else:
                u, d = 0, 0
            UDitem = {
                'open_time': candle['open_time'],
                'U': u,
                'D': d, }
            UDlist.append(UDitem)
            i += 1
        return UDlist

    def calc_average_diff(UDlist=getUDvalues()):
        UDavglist = []
        smU = 0.0000
        smD = 0.0000
        i = 0
        for UD in UDlist:
            if i > n - 1:
                avgU = (avgU_tminus * (n - 1) + UD['U']) / n
                avgD = (avgD_tminus * (n - 1) + UD['D']) / n
                avgU_tminus = avgU
                avgD_tminus = avgD
            elif i < n - 1:
                smU += float(UD['U'])
                smD += float(UD['D'])
                avgU = 0
                avgD = 0
                avgU_tminus = 0
                avgD_tminus = 0
            else:
                smU += float(UD['U'])
                smD += float(UD['D'])
                avgU = smU / n
                avgD = smD / n
                avgU_tminus = avgU
                avgD_tminus = avgD
            UDavgitem = {'open_time': UD['open_time'],
                         'avgU': avgU,
                         'avgD': avgD}
            UDavglist.append(UDavgitem)
            i += 1
        return UDavglist

    def calc_RS_values(UDavglist=calc_average_diff()):
        RSlist = []
        for UDavg in UDavglist:
            if UDavg['avgD']:
                rs = UDavg['avgU'] / UDavg['avgD']
            else:
                rs = 0
            RSitem = {'open_time': UDavg['open_time'],
                      'RS': rs}
            RSlist.append(RSitem)
        return RSlist

    def getRSIvalues(RSlist=calc_RS_values())->list[dict]:
        rsilist = []
        for rs in RSlist:
            rsi = {'open_time': rs['open_time'],
                   'RSI'+str(n): 100 - 100 / (1 + rs['RS'])}
            rsilist.append(rsi)
        return rsilist

    return getRSIvalues()



if __name__ == '__main__':
    data = [
        {'open_time': 1676444400000, 'ohlc': ['22118.05000000', '22199.29000000', '22098.00000000', '22109.89000000']},
        {'open_time': 1676448000000, 'ohlc': ['22109.89000000', '22131.63000000', '22089.11000000', '22094.02000000']},
        {'open_time': 1676451600000, 'ohlc': ['22094.62000000', '22199.60000000', '22089.78000000', '22170.51000000']},
        {'open_time': 1676455200000, 'ohlc': ['22169.70000000', '22257.91000000', '22145.76000000', '22234.96000000']},
        {'open_time': 1676458800000, 'ohlc': ['22234.74000000', '22500.00000000', '22222.81000000', '22445.13000000']},
        {'open_time': 1676462400000, 'ohlc': ['22444.28000000', '22916.98000000', '22443.24000000', '22772.21000000']},
        {'open_time': 1676466000000, 'ohlc': ['22772.21000000', '22783.74000000', '22666.00000000', '22698.86000000']},
        {'open_time': 1676469600000, 'ohlc': ['22698.81000000', '22797.88000000', '22620.00000000', '22684.47000000']},
        {'open_time': 1676473200000, 'ohlc': ['22685.60000000', '22884.77000000', '22661.66000000', '22809.46000000']},
        {'open_time': 1676476800000, 'ohlc': ['22809.46000000', '22943.17000000', '22746.36000000', '22763.10000000']},
        {'open_time': 1676480400000, 'ohlc': ['22763.10000000', '22835.89000000', '22745.03000000', '22805.48000000']},
        {'open_time': 1676484000000, 'ohlc': ['22805.48000000', '23052.99000000', '22771.86000000', '22973.86000000']},
        {'open_time': 1676487600000, 'ohlc': ['22974.54000000', '23353.87000000', '22945.54000000', '23318.90000000']},
        {'open_time': 1676491200000, 'ohlc': ['23320.18000000', '24300.00000000', '23296.30000000', '24145.04000000']},
        {'open_time': 1676494800000, 'ohlc': ['24146.60000000', '24250.00000000', '24009.70000000', '24175.86000000']},
        {'open_time': 1676498400000, 'ohlc': ['24175.01000000', '24380.00000000', '24108.77000000', '24151.60000000']},
        {'open_time': 1676502000000, 'ohlc': ['24150.26000000', '24344.00000000', '24148.00000000', '24324.05000000']},
        {'open_time': 1676505600000, 'ohlc': ['24322.87000000', '24905.00000000', '24278.58000000', '24583.17000000']},
        {'open_time': 1676509200000, 'ohlc': ['24584.40000000', '24683.81000000', '24560.96000000', '24627.17000000']},
        {'open_time': 1676512800000, 'ohlc': ['24627.17000000', '24744.75000000', '24604.34000000', '24687.88000000']},
        {'open_time': 1676516400000, 'ohlc': ['24687.88000000', '24758.38000000', '24655.22000000', '24732.42000000']},
        {'open_time': 1676520000000, 'ohlc': ['24731.60000000', '24756.35000000', '24631.35000000', '24634.15000000']},
        {'open_time': 1676523600000, 'ohlc': ['24633.46000000', '24714.82000000', '24602.00000000', '24681.94000000']},
        {'open_time': 1676527200000, 'ohlc': ['24681.94000000', '24734.37000000', '24568.10000000', '24586.08000000']},
        {'open_time': 1676530800000, 'ohlc': ['24583.90000000', '24657.48000000', '24430.12000000', '24612.95000000']},
        {'open_time': 1676534400000, 'ohlc': ['24611.51000000', '24664.49000000', '24565.90000000', '24580.34000000']},
        {'open_time': 1676538000000, 'ohlc': ['24579.25000000', '24652.49000000', '24557.11000000', '24643.64000000']},
        {'open_time': 1676541600000, 'ohlc': ['24642.73000000', '24659.00000000', '24600.50000000', '24617.72000000']},
        {'open_time': 1676545200000, 'ohlc': ['24617.20000000', '24624.99000000', '24509.07000000', '24568.55000000']},
        {'open_time': 1676548800000, 'ohlc': ['24567.93000000', '24609.72000000', '24448.78000000', '24585.55000000']},
        {'open_time': 1676552400000, 'ohlc': ['24585.54000000', '24663.99000000', '24355.00000000', '24445.81000000']},
        {'open_time': 1676556000000, 'ohlc': ['24446.19000000', '24497.96000000', '24283.35000000', '24423.80000000']},
        {'open_time': 1676559600000, 'ohlc': ['24423.80000000', '25091.00000000', '24381.14000000', '25072.67000000']},
        {'open_time': 1676563200000, 'ohlc': ['25072.67000000', '25250.00000000', '24606.14000000', '24898.43000000']},
        {'open_time': 1676566800000, 'ohlc': ['24897.39000000', '24960.46000000', '24766.00000000', '24891.88000000']},
        {'open_time': 1676570400000, 'ohlc': ['24891.88000000', '25040.32000000', '24855.00000000', '24971.47000000']},
        {'open_time': 1676574000000, 'ohlc': ['24970.77000000', '24998.68000000', '24831.45000000', '24872.58000000']},
        {'open_time': 1676577600000, 'ohlc': ['24872.58000000', '24879.81000000', '24447.47000000', '24565.36000000']},
        {'open_time': 1676581200000, 'ohlc': ['24565.36000000', '24578.58000000', '24357.83000000', '24537.04000000']},
        {'open_time': 1676584800000, 'ohlc': ['24538.38000000', '24552.46000000', '23966.20000000', '23994.76000000']},
        {'open_time': 1676588400000, 'ohlc': ['23994.78000000', '24096.70000000', '23505.25000000', '23517.72000000']},
        {'open_time': 1676592000000, 'ohlc': ['23517.72000000', '23778.22000000', '23339.37000000', '23713.37000000']},
        {'open_time': 1676595600000, 'ohlc': ['23713.37000000', '23880.00000000', '23638.63000000', '23849.87000000']},
        {'open_time': 1676599200000, 'ohlc': ['23849.87000000', '23854.85000000', '23751.85000000', '23772.31000000']},
        {'open_time': 1676602800000, 'ohlc': ['23772.31000000', '23914.58000000', '23757.14000000', '23838.64000000']},
        {'open_time': 1676606400000, 'ohlc': ['23838.64000000', '23883.12000000', '23722.61000000', '23805.15000000']},
        {'open_time': 1676610000000, 'ohlc': ['23805.14000000', '23812.29000000', '23686.29000000', '23707.55000000']},
        {'open_time': 1676613600000, 'ohlc': ['23708.43000000', '23751.09000000', '23612.00000000', '23668.10000000']},
        {'open_time': 1676617200000, 'ohlc': ['23668.10000000', '23786.11000000', '23628.36000000', '23637.04000000']},
        {'open_time': 1676620800000, 'ohlc': ['23635.84000000', '23814.31000000', '23532.69000000', '23797.21000000']},
        {'open_time': 1676624400000, 'ohlc': ['23797.90000000', '23861.78000000', '23712.21000000', '23743.22000000']},
        {'open_time': 1676628000000, 'ohlc': ['23743.01000000', '23790.00000000', '23672.62000000', '23753.42000000']},
        {'open_time': 1676631600000, 'ohlc': ['23754.17000000', '23842.02000000', '23735.68000000', '23789.82000000']},
        {'open_time': 1676635200000, 'ohlc': ['23789.12000000', '23909.87000000', '23766.62000000', '23869.46000000']},
        {'open_time': 1676638800000, 'ohlc': ['23870.38000000', '23888.96000000', '23753.00000000', '23782.23000000']},
        {'open_time': 1676642400000, 'ohlc': ['23783.12000000', '24247.38000000', '23710.00000000', '23865.86000000']},
        {'open_time': 1676646000000, 'ohlc': ['23863.31000000', '24280.00000000', '23850.08000000', '24130.50000000']},
        {'open_time': 1676649600000, 'ohlc': ['24130.50000000', '24332.75000000', '23917.65000000', '24091.21000000']},
        {'open_time': 1676653200000, 'ohlc': ['24091.21000000', '24520.00000000', '24084.84000000', '24298.35000000']},
        {'open_time': 1676656800000, 'ohlc': ['24298.35000000', '24416.65000000', '24219.23000000', '24360.66000000']},
        {'open_time': 1676660400000, 'ohlc': ['24360.66000000', '24560.64000000', '24237.26000000', '24524.49000000']},
        {'open_time': 1676664000000, 'ohlc': ['24524.49000000', '25021.11000000', '24515.00000000', '24820.92000000']},
        {'open_time': 1676667600000, 'ohlc': ['24820.92000000', '24835.06000000', '24405.88000000', '24476.42000000']},
        {'open_time': 1676671200000, 'ohlc': ['24476.42000000', '24737.84000000', '24051.73000000', '24679.14000000']},
        {'open_time': 1676674800000, 'ohlc': ['24678.09000000', '24750.00000000', '24511.81000000', '24569.97000000']},
        {'open_time': 1676678400000, 'ohlc': ['24568.24000000', '24787.50000000', '24533.54000000', '24632.74000000']},
        {'open_time': 1676682000000, 'ohlc': ['24631.51000000', '24683.73000000', '24572.32000000', '24660.14000000']},
        {'open_time': 1676685600000, 'ohlc': ['24660.14000000', '24674.31000000', '24503.49000000', '24555.86000000']},
        {'open_time': 1676689200000, 'ohlc': ['24556.61000000', '24639.55000000', '24535.32000000', '24609.68000000']},
        {'open_time': 1676692800000, 'ohlc': ['24609.68000000', '24653.86000000', '24592.88000000', '24624.01000000']},
        {'open_time': 1676696400000, 'ohlc': ['24624.01000000', '24646.78000000', '24600.00000000', '24641.42000000']},
        {'open_time': 1676700000000, 'ohlc': ['24641.80000000', '24676.90000000', '24607.42000000', '24626.66000000']},
        {'open_time': 1676703600000, 'ohlc': ['24625.86000000', '24626.65000000', '24430.00000000', '24519.01000000']},
        {'open_time': 1676707200000, 'ohlc': ['24519.01000000', '24607.82000000', '24458.82000000', '24588.51000000']},
        {'open_time': 1676710800000, 'ohlc': ['24588.51000000', '24596.02000000', '24540.49000000', '24553.04000000']},
        {'open_time': 1676714400000, 'ohlc': ['24553.43000000', '24566.32000000', '24453.23000000', '24456.81000000']},
        {'open_time': 1676718000000, 'ohlc': ['24456.72000000', '24555.89000000', '24436.46000000', '24519.42000000']},
        {'open_time': 1676721600000, 'ohlc': ['24519.93000000', '24647.94000000', '24488.43000000', '24620.33000000']},
        {'open_time': 1676725200000, 'ohlc': ['24619.18000000', '24644.06000000', '24559.02000000', '24581.77000000']},
        {'open_time': 1676728800000, 'ohlc': ['24581.77000000', '24734.32000000', '24531.68000000', '24691.13000000']},
        {'open_time': 1676732400000, 'ohlc': ['24692.09000000', '24723.92000000', '24627.07000000', '24668.26000000']},
        {'open_time': 1676736000000, 'ohlc': ['24667.02000000', '24694.01000000', '24635.01000000', '24642.84000000']},
        {'open_time': 1676739600000, 'ohlc': ['24642.19000000', '24713.09000000', '24577.00000000', '24686.00000000']},
        {'open_time': 1676743200000, 'ohlc': ['24685.26000000', '24877.00000000', '24640.13000000', '24710.54000000']},
        {'open_time': 1676746800000, 'ohlc': ['24710.18000000', '24734.14000000', '24567.90000000', '24608.34000000']},
        {'open_time': 1676750400000, 'ohlc': ['24608.34000000', '24628.62000000', '24514.03000000', '24594.70000000']},
        {'open_time': 1676754000000, 'ohlc': ['24594.69000000', '24639.40000000', '24580.62000000', '24615.83000000']},
        {'open_time': 1676757600000, 'ohlc': ['24616.31000000', '24664.90000000', '24599.22000000', '24627.32000000']},
        {'open_time': 1676761200000, 'ohlc': ['24627.32000000', '24666.00000000', '24618.67000000', '24631.95000000']},
        {'open_time': 1676764800000, 'ohlc': ['24632.05000000', '24764.85000000', '24622.18000000', '24739.25000000']},
        {'open_time': 1676768400000, 'ohlc': ['24739.23000000', '24770.67000000', '24635.94000000', '24707.49000000']},
        {'open_time': 1676772000000, 'ohlc': ['24708.10000000', '24733.29000000', '24667.30000000', '24683.57000000']},
        {'open_time': 1676775600000, 'ohlc': ['24683.02000000', '24710.00000000', '24660.05000000', '24681.69000000']},
        {'open_time': 1676779200000, 'ohlc': ['24682.10000000', '24729.20000000', '24672.50000000', '24712.85000000']},
        {'open_time': 1676782800000, 'ohlc': ['24712.38000000', '24850.00000000', '24706.39000000', '24757.63000000']},
        {'open_time': 1676786400000, 'ohlc': ['24758.16000000', '24760.79000000', '24610.20000000', '24628.59000000']},
        {'open_time': 1676790000000, 'ohlc': ['24629.41000000', '24666.57000000', '24563.23000000', '24582.62000000']},
        {'open_time': 1676793600000, 'ohlc': ['24582.62000000', '24628.47000000', '24560.47000000', '24569.06000000']},
        {'open_time': 1676797200000, 'ohlc': ['24569.69000000', '24629.99000000', '24566.42000000', '24599.42000000']},
        {'open_time': 1676800800000, 'ohlc': ['24599.42000000', '24637.97000000', '24581.00000000', '24622.72000000']}]
    print(calc_RSI(data))